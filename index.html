<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMBIGRAMOO</title>
  <meta name="description" content="Create rotational & mirror ambigrams in seconds. Edit ligatures, preview flips, and export SVG/PNG/PDF right in your browser." />
  <meta name="theme-color" content="#111827" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;800&family=Montserrat:wght@500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {color-scheme: dark;}
    .font-display{font-family:"Playfair Display",serif}
    .font-sansx{font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto}
    .font-monox{font-family:"JetBrains Mono",ui-monospace,monospace}
    .glass{backdrop-filter: blur(10px); background: rgba(255,255,255,0.06);}
    .no-select{user-select:none;-webkit-user-select:none}
    /* Hide default file input */
    input[type="file"]{display:none}
  </style>
</head>
<body class="bg-gray-950 text-gray-100 font-sansx">
  <!-- ====== NAV / HERO ====== -->
  <header class="max-w-7xl mx-auto px-6 pt-8 pb-4">
    <nav class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-indigo-600 grid place-items-center font-black">JZ</div>
        <span class="text-lg font-bold tracking-wider">AMBIGRAMOO</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnGoProTop" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">Go Pro</button>
        <a href="#faq" class="px-3 py-2 text-sm text-white/70 hover:text-white/100">FAQ</a>
      </div>
    </nav>

    <div class="mt-10 grid lg:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Design Ambigrams, <span class="text-white/70">Beautifully.</span></h1>
        <p class="mt-3 text-white/70">Type words, choose symmetry, tweak ligatures, and export in SVG/PNG/PDF. All in one single page.</p>

        <form id="heroForm" class="mt-6 grid sm:grid-cols-2 gap-3">
          <input id="wordA" required placeholder="Word A" class="px-4 py-3 rounded-xl bg-white/5 outline-none" />
          <input id="wordB" placeholder="Word B (optional)" class="px-4 py-3 rounded-xl bg-white/5 outline-none" />
          <select id="symmetry" class="px-4 py-3 rounded-xl bg-white/5 outline-none sm:col-span-2">
            <option value="rotational">Rotational (180°)</option>
            <option value="mirror-v">Mirror Vertical</option>
            <option value="mirror-h">Mirror Horizontal</option>
          </select>
          <div class="sm:col-span-2 flex gap-3">
            <button id="btnGenerate" type="button" class="px-5 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 font-semibold">Generate</button>
            <button id="btnOpenEditor" type="button" class="px-5 py-3 rounded-xl bg-white/10 hover:bg-white/20">Open Editor</button>
          </div>
        </form>

        <div class="mt-4 text-sm text-white/50">Rotation: <span id="angleLabel">180°</span></div>
        <input id="angle" type="range" min="0" max="360" value="180" class="mt-2 w-full" />
      </div>

      <div>
        <div id="livePreviewWrap" class="relative rounded-2xl glass p-4 border border-white/10">
          <div class="absolute -top-3 left-4 text-xs px-2 py-1 rounded-lg bg-indigo-600">Live Preview</div>
          <svg id="previewSVG" viewBox="0 0 1200 400" class="w-full h-[320px] bg-gradient-to-br from-gray-900 to-gray-800 rounded-xl"></svg>
          <div class="mt-3 flex flex-wrap gap-2 text-xs">
            <button data-style="display" class="styleBtn px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Display</button>
            <button data-style="sans" class="styleBtn px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Sans</button>
            <button data-style="mono" class="styleBtn px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Mono</button>
            <button data-style="outline" class="styleBtn px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Outline</button>
            <button data-style="black" class="styleBtn px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Black</button>
          </div>
        </div>
        <div class="mt-4 flex flex-wrap gap-3">
          <button id="btnDownloadPNG" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">Download PNG</button>
          <button id="btnDownloadSVG" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">Download SVG</button>
          <button id="btnDownloadPDF" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">Download PDF</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ====== GALLERY ====== -->
  <section id="gallery" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-3">Explore</h2>
    <p class="text-white/70 mb-6">Sample ambigrams generated with different symmetry and styles. Click any to open in editor.</p>
    <div id="galleryGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
  </section>

  <!-- ====== HOW IT WORKS ====== -->
  <section id="how" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-3">How it works</h2>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="p-5 rounded-2xl bg-white/5 border border-white/10">
        <div class="text-sm text-indigo-400 font-semibold">Step 1</div>
        <h3 class="mt-1 font-semibold">Type your words</h3>
        <p class="mt-2 text-white/70">Choose symmetry and a style. Start with common pairings like A↔V, M↔W, n↔u, p↔d, S↔Z.</p>
      </div>
      <div class="p-5 rounded-2xl bg-white/5 border border-white/10">
        <div class="text-sm text-indigo-400 font-semibold">Step 2</div>
        <h3 class="mt-1 font-semibold">Tweak & refine</h3>
        <p class="mt-2 text-white/70">Adjust spacing, rotate, or mirror. Use the editor overlay to fine-tune ligatures.</p>
      </div>
      <div class="p-5 rounded-2xl bg-white/5 border border-white/10">
        <div class="text-sm text-indigo-400 font-semibold">Step 3</div>
        <h3 class="mt-1 font-semibold">Export & use</h3>
        <p class="mt-2 text-white/70">Download clean SVG/PNG/PDF. Place it on mockups for shirts, mugs, or logos.</p>
      </div>
    </div>
  </section>

  <!-- ====== MINI TUTORIALS ====== -->
  <section id="tutorials" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-4">Mini Tutorials</h2>
    <div class="space-y-4">
      <details class="bg-white/5 border border-white/10 rounded-xl p-4">
        <summary class="cursor-pointer font-semibold">Rotational basics</summary>
        <p class="mt-2 text-white/75">A rotational ambigram reads as another word (or the same) when rotated 180°. Start by aligning stems and counters so the reversed form suggests the target letters.</p>
      </details>
      <details class="bg-white/5 border border-white/10 rounded-xl p-4">
        <summary class="cursor-pointer font-semibold">Mirror tricks</summary>
        <p class="mt-2 text-white/75">Vertical mirroring works best with symmetrical glyphs (A, H, I, M, O, T, U, V, W, X, Y). Combine with stylized terminals to disguise the reflection.</p>
      </details>
      <details class="bg-white/5 border border-white/10 rounded-xl p-4">
        <summary class="cursor-pointer font-semibold">Ligature builder</summary>
        <p class="mt-2 text-white/75">Fuse neighboring letters into shared strokes. Focus on stroke continuity and negative-space balance to keep readability in both orientations.</p>
      </details>
    </div>
    <div class="mt-6">
      <a id="btnPracticePDF" class="inline-block px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20" href="#">Download practice sheets (PDF)</a>
    </div>
  </section>

  <!-- ====== LICENSING & USE CASES ====== -->
  <section id="license" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-3">Licensing & Use Cases</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="p-5 rounded-2xl bg-white/5 border border-white/10">
        <h3 class="font-semibold">Personal</h3>
        <p class="mt-2 text-white/70">Use exports for personal projects and social media. Attribution appreciated.</p>
      </div>
      <div class="p-5 rounded-2xl bg-white/5 border border-white/10">
        <h3 class="font-semibold">Commercial</h3>
        <p class="mt-2 text-white/70">Use for logos, merch, and client work. Purchase a license at export (Pro) to remove limitations.</p>
      </div>
    </div>
  </section>

  <!-- ====== PRICING ====== -->
  <section id="pricing" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-6">Pricing</h2>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="p-6 rounded-2xl bg-white/5 border border-white/10">
        <h3 class="font-semibold text-lg">Free</h3>
        <ul class="mt-2 text-white/70 list-disc list-inside space-y-1">
          <li>Basic editor & preview</li>
          <li>PNG export (up to 2×)</li>
          <li>Local autosave</li>
        </ul>
      </div>
      <div class="p-6 rounded-2xl bg-indigo-600">
        <h3 class="font-semibold text-lg">Pro</h3>
        <ul class="mt-2 text-white list-disc list-inside space-y-1">
          <li>SVG, PDF, high‑DPI PNG</li>
          <li>Mockups & version history</li>
          <li>Commercial license presets</li>
        </ul>
        <button id="btnGoPro" class="mt-4 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">Upgrade</button>
      </div>
    </div>
  </section>

  <!-- ====== FAQ & FOOTER ====== -->
  <section id="faq" class="max-w-7xl mx-auto px-6 py-12">
    <h2 class="text-2xl font-bold mb-4">FAQ</h2>
    <div class="space-y-3">
      <details class="bg-white/5 p-4 rounded-xl border border-white/10">
        <summary class="cursor-pointer font-semibold">Who owns the artwork?</summary>
        <p class="mt-2 text-white/75">You own your exports. For commercial use, attach a Pro license at export time.</p>
      </details>
      <details class="bg-white/5 p-4 rounded-xl border border-white/10">
        <summary class="cursor-pointer font-semibold">Can I upload my own fonts?</summary>
        <p class="mt-2 text-white/75">In this MVP, you can pick built‑in styles. Custom fonts are planned for a future update.</p>
      </details>
      <details class="bg-white/5 p-4 rounded-xl border border-white/10">
        <summary class="cursor-pointer font-semibold">What’s the export quality?</summary>
        <p class="mt-2 text-white/75">SVG is vector perfect. PNG exports up to 4× (Pro). PDF is vector for print.</p>
      </details>
    </div>
    <footer class="mt-10 border-t border-white/10 pt-6 text-sm text-white/50 flex flex-col sm:flex-row gap-3 sm:gap-0 justify-between">
      <span>© </span>
      <div class="flex gap-4">
        <a href="#license" class="hover:text-white/80">License</a>
        <a href="#pricing" class="hover:text-white/80">Pricing</a>
        <a href="#" class="hover:text-white/80">Privacy & Terms</a>
      </div>
    </footer>
  </section>

  <!-- ====== EDITOR OVERLAY ====== -->
  <div id="editorOverlay" class="hidden fixed inset-0 bg-black/70 backdrop-blur z-40">
    <div class="max-w-7xl mx-auto my-8 bg-gray-900 rounded-2xl p-4 h-[86vh] border border-white/10">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div class="flex items-center gap-2">
          <h4 class="font-semibold">Ambigram Editor</h4>
          <span class="text-xs text-white/50">(Local autosave)</span>
        </div>
        <div class="flex flex-wrap gap-2">
          <button id="btnMockup" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Mockup</button>
          <button id="btnSaveLocal" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Save Draft</button>
          <button id="btnCloseEditor" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20">Close</button>
        </div>
      </div>
      <div class="grid lg:grid-cols-4 gap-4 mt-4 h-[calc(86vh-60px)]">
        <!-- Tools -->
        <aside class="lg:col-span-1 space-y-3 overflow-auto pr-1">
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Words</label>
            <input id="edWordA" class="mt-1 w-full px-3 py-2 rounded-lg bg-white/5" placeholder="Word A" />
            <input id="edWordB" class="mt-2 w-full px-3 py-2 rounded-lg bg-white/5" placeholder="Word B (optional)" />
          </div>
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Symmetry</label>
            <select id="edSymmetry" class="mt-1 w-full px-3 py-2 rounded-lg bg-white/5">
              <option value="rotational">Rotational (180°)</option>
              <option value="mirror-v">Mirror Vertical</option>
              <option value="mirror-h">Mirror Horizontal</option>
            </select>
            <div class="mt-3 text-xs text-white/60">Rotation: <span id="edAngleLabel">180°</span></div>
            <input id="edAngle" type="range" min="0" max="360" value="180" class="w-full" />
          </div>
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Style</label>
            <div class="mt-2 flex flex-wrap gap-2">
              <button data-style="display" class="edStyle px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Display</button>
              <button data-style="sans" class="edStyle px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Sans</button>
              <button data-style="mono" class="edStyle px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Mono</button>
              <button data-style="outline" class="edStyle px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Outline</button>
              <button data-style="black" class="edStyle px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20">Black</button>
            </div>
          </div>
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Spacing</label>
            <input id="edLetterSpace" type="range" min="-2" max="8" value="0" step="0.5" class="w-full" />
            <div class="text-xs text-white/60 mt-1">Letter spacing: <span id="edLsVal">0</span></div>
          </div>
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Exports</label>
            <div class="mt-2 grid grid-cols-3 gap-2">
              <button id="edExportPNG" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-xs">PNG</button>
              <button id="edExportSVG" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-xs">SVG</button>
              <button id="edExportPDF" class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-xs">PDF</button>
            </div>
          </div>
          <div class="p-3 rounded-xl bg-white/5 border border-white/10">
            <label class="text-xs text-white/60">Templates</label>
            <div id="templateList" class="mt-2 grid grid-cols-2 gap-2"></div>
          </div>
        </aside>
        <!-- Canvas -->
        <main class="lg:col-span-3 rounded-xl bg-gray-800 border border-white/10 grid place-items-center overflow-hidden">
          <svg id="editorSVG" viewBox="0 0 1600 900" class="w-full h-full"></svg>
        </main>
      </div>
    </div>
  </div>

  <!-- ====== MOCKUP MODAL ====== -->
  <div id="mockupModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur z-50">
    <div class="max-w-4xl mx-auto my-10 bg-gray-900 rounded-2xl p-4 border border-white/10">
      <div class="flex items-center justify-between">
        <h4 class="font-semibold">Quick Mockup</h4>
        <button id="btnCloseMockup" class="px-3 py-1 rounded-lg bg-white/10 hover:bg-white/20">Close</button>
      </div>
      <div class="mt-3 grid md:grid-cols-2 gap-4">
        <div class="p-4 rounded-xl bg-white/5 border border-white/10 grid place-items-center">
          <canvas id="mockupTee" width="900" height="900" class="rounded-xl"></canvas>
          <div class="text-xs text-white/50 mt-2">T‑shirt preview</div>
        </div>
        <div class="p-4 rounded-xl bg-white/5 border border-white/10 grid place-items-center">
          <canvas id="mockupMug" width="900" height="600" class="rounded-xl"></canvas>
          <div class="text-xs text-white/50 mt-2">Mug preview</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ====== SCRIPTS ====== -->
  <script>
    /* =============================
       State & Utilities
    ==============================*/
    const state = {
      words: { a: '', b: '' },
      symmetry: 'rotational',
      angle: 180,
      style: 'display',
      letterSpacing: 0,
      // limits for Free vs Pro (demo gating only; no real paywall)
      isPro: false,
    };

    const fonts = {
      display: { family: 'Playfair Display', weight: 800 },
      sans: { family: 'Montserrat', weight: 900 },
      mono: { family: 'JetBrains Mono', weight: 700 },
      outline: { family: 'Montserrat', weight: 700, stroke: true },
      black: { family: 'Playfair Display', weight: 900 },
    };

    function $(sel){return document.querySelector(sel)}
    function $all(sel){return Array.from(document.querySelectorAll(sel))}

    function clamp(n, a, b){return Math.max(a, Math.min(b, n))}

    function toTitle(s){ return (s||'').toString().trim(); }

    function setHashFromState(){
      const p = new URLSearchParams({
        a: state.words.a || '',
        b: state.words.b || '',
        sym: state.symmetry,
        ang: String(state.angle),
        sty: state.style,
        ls: String(state.letterSpacing)
      });
      location.hash = p.toString();
      document.title = `Ambigram: ${state.words.a || ''}${state.words.b? ' ↔ ' + state.words.b : ''} | AMBIGRAMOO`;
    }

    function loadStateFromHash(){
      const hash = location.hash.replace(/^#/, '');
      const p = new URLSearchParams(hash);
      state.words.a = p.get('a') || state.words.a;
      state.words.b = p.get('b') || state.words.b;
      state.symmetry = p.get('sym') || state.symmetry;
      state.angle = Number(p.get('ang') || state.angle);
      state.style = p.get('sty') || state.style;
      state.letterSpacing = Number(p.get('ls') || state.letterSpacing);
    }

    function saveLocal(){
      localStorage.setItem('thejazz_state', JSON.stringify(state));
    }
    function restoreLocal(){
      const raw = localStorage.getItem('thejazz_state');
      if(!raw) return;
      try { Object.assign(state, JSON.parse(raw)); } catch{}
    }

    /* =============================
       SVG Render Helpers
    ==============================*/
    function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }

    function createTextNode(x, y, text, opts={}){
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', x);
      t.setAttribute('y', y);
      t.setAttribute('text-anchor','middle');
      t.setAttribute('dominant-baseline','middle');
      t.setAttribute('style', `font-family:${opts.family}; font-weight:${opts.weight||700}; letter-spacing:${state.letterSpacing}px;`);
      t.textContent = text;
      if(opts.stroke){
        t.setAttribute('fill','none');
        t.setAttribute('stroke','white');
        t.setAttribute('stroke-width','2');
      }
      return t;
    }

    function renderAmbigram(svg, box){
      clear(svg);
      const { a, b } = state.words;
      const family = fonts[state.style].family;
      const weight = fonts[state.style].weight;
      const stroke = !!fonts[state.style].stroke;

      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      svg.appendChild(g);

      // Background grid (subtle)
      const bg = document.createElementNS('http://www.w3.org/2000/svg','rect');
      bg.setAttribute('x', 0); bg.setAttribute('y', 0);
      bg.setAttribute('width', box.w); bg.setAttribute('height', box.h);
      bg.setAttribute('fill','url(#grad)');
      g.appendChild(bg);

      // defs
      const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
      const grad = document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
      grad.setAttribute('id','grad');
      grad.setAttribute('x1','0'); grad.setAttribute('y1','0');
      grad.setAttribute('x2','1'); grad.setAttribute('y2','1');
      const s1 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#111827');
      const s2 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#0b1220');
      grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad);
      svg.appendChild(defs);

      const centerX = box.w/2;
      const centerY = box.h/2;

      if(state.symmetry === 'rotational'){
        // Show word A upright; show word B (or A) rotated 180° (or given angle)
        const topText = createTextNode(centerX, centerY - 40, a || 'AMBIGRAMOO', {family, weight, stroke});
        topText.setAttribute('font-size','140');
        g.appendChild(topText);

        const bottomText = createTextNode(centerX, centerY + 40, (b || a || '').split('').reverse().join(''), {family, weight, stroke});
        bottomText.setAttribute('font-size','140');
        bottomText.setAttribute('transform', `rotate(${state.angle}, ${centerX}, ${centerY})`);
        g.appendChild(bottomText);
      } else if(state.symmetry === 'mirror-v'){
        const main = createTextNode(centerX, centerY - 20, a || 'AMBIGRAMOO', {family, weight, stroke});
        main.setAttribute('font-size','160'); g.appendChild(main);

        const mirror = createTextNode(centerX, centerY + 20, (b || a || ''), {family, weight, stroke});
        mirror.setAttribute('font-size','160');
        mirror.setAttribute('transform', `scale(1,-1) translate(0 ${-box.h})`);
        g.appendChild(mirror);
      } else if(state.symmetry === 'mirror-h'){
        const main = createTextNode(centerX - 40, centerY, a || 'THE', {family, weight, stroke});
        main.setAttribute('font-size','160'); g.appendChild(main);

        const mirror = createTextNode(centerX + 40, centerY, (b || a || ''), {family, weight, stroke});
        mirror.setAttribute('font-size','160');
        mirror.setAttribute('transform', `scale(-1,1) translate(${-box.w} 0)`);
        g.appendChild(mirror);
      }
    }

    function renderPreview(){
      const svg = $('#previewSVG');
      renderAmbigram(svg, {w:1200, h:400});
      $('#angleLabel').textContent = `${state.angle}°`;
    }

    function renderEditor(){
      const svg = $('#editorSVG');
      renderAmbigram(svg, {w:1600, h:900});
      $('#edAngleLabel').textContent = `${state.angle}°`;
      $('#edLsVal').textContent = `${state.letterSpacing}`;
    }

    /* =============================
       Exports
    ==============================*/
    function svgToString(svg){
      const clone = svg.cloneNode(true);
      // Remove inline sizes to keep viewBox behavior
      clone.removeAttribute('width');
      clone.removeAttribute('height');
      return new XMLSerializer().serializeToString(clone);
    }

    function download(filename, blob){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 50);
    }

    function exportSVG(targetId, name='ambigram'){
      const svg = $(targetId);
      const str = svgToString(svg);
      download(`${name}.svg`, new Blob([str], {type:'image/svg+xml'}));
    }

    function exportPNG(targetId, name='ambigram', scale=2){
      const svg = $(targetId);
      const str = svgToString(svg);
      const img = new Image();
      const svgBlob = new Blob([str], {type:'image/svg+xml'});
      const url = URL.createObjectURL(svgBlob);
      img.onload = () => {
        const vb = (svg.getAttribute('viewBox')||'0 0 1200 400').split(' ').map(Number);
        const [x,y,w,h]=vb;
        const canvas = document.createElement('canvas');
        canvas.width = w*scale; canvas.height = h*scale;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#0b1220';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img, 0,0, canvas.width, canvas.height);
        canvas.toBlob(b => download(`${name}.png`, b), 'image/png');
        URL.revokeObjectURL(url);
      };
      img.src = url;
    }

    // Simple PDF via canvas (vector PDF would require lib; this keeps it single-file)
    function exportPDFviaCanvas(targetId, name='ambigram'){
      // Create a PNG first, then embed via a minimalist PDF generator
      const svg = $(targetId);
      const str = svgToString(svg);
      const img = new Image();
      const svgBlob = new Blob([str], {type:'image/svg+xml'});
      const url = URL.createObjectURL(svgBlob);
      img.onload = () => {
        const vb = (svg.getAttribute('viewBox')||'0 0 1200 400').split(' ').map(Number);
        const [x,y,w,h]=vb;
        const canvas = document.createElement('canvas');
        canvas.width = w; canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#0b1220'; ctx.fillRect(0,0,w,h);
        ctx.drawImage(img,0,0,w,h);
        canvas.toBlob(bPNG => {
          // Create a super‑basic PDF (A4 landscape) using a tiny inline writer
          // PDF header parts (not a full engine; enough for embedding one image)
          // For simplicity and reliability, we will prompt to save PNG instead if Pro not enabled
          if(!state.isPro){
            alert('PDF export is a Pro feature in this demo. Use SVG/PNG or click Upgrade.');
            return;
          }
          // If Pro enabled, just download PNG with .pdf name to keep single-file demo simple
          // (Production should use a PDF library.)
          download(`${name}.pdf`, bPNG);
        }, 'image/png');
        URL.revokeObjectURL(url);
      };
      img.src = url;
    }

    /* =============================
       Gallery & Templates
    ==============================*/
    const samplePairs = [
      {a:'LOVE', b:'HATE', sym:'rotational', sty:'display'},
      {a:'NORTH', b:'SOUTH', sym:'rotational', sty:'sans'},
      {a:'RISE', b:'RISE', sym:'mirror-v', sty:'black'},
      {a:'NOON', b:'NOON', sym:'mirror-h', sty:'mono'},
      {a:'JAZZ', b:'JAZZ', sym:'rotational', sty:'outline'},
      {a:'LIGHT', b:'DARK', sym:'rotational', sty:'display'},
      {a:'MIRROR', b:'IMAGE', sym:'mirror-v', sty:'sans'},
      {a:'UNITY', b:'UNITY', sym:'mirror-h', sty:'black'},
    ];

    function buildGallery(){
      const grid = $('#galleryGrid'); grid.innerHTML = '';
      samplePairs.forEach((p, i)=>{
        const card = document.createElement('button');
        card.className = 'aspect-square rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 relative';
        card.setAttribute('title', `${p.a} ↔ ${p.b} (${p.sym})`);

        const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
        svg.setAttribute('viewBox','0 0 600 600');
        svg.classList.add('w-full','h-full','rounded-xl');
        card.appendChild(svg);

        const prevState = {...state};
        state.words = {a:p.a, b:p.b};
        state.symmetry = p.sym; state.style = p.sty; state.angle = 180; state.letterSpacing = 0;
        renderAmbigram(svg, {w:600,h:600});
        Object.assign(state, prevState);

        card.addEventListener('click', ()=>{
          state.words = {a:p.a, b:p.b};
          state.symmetry = p.sym; state.style = p.sty; state.angle = 180; state.letterSpacing = 0;
          openEditor();
        });
        grid.appendChild(card);
      });
    }

    function buildTemplates(){
      const wrap = $('#templateList'); wrap.innerHTML = '';
      const templates = [
        {name:'Elegant', sty:'display', ls:0},
        {name:'Bold Sans', sty:'sans', ls:1},
        {name:'Mono Tech', sty:'mono', ls:0},
        {name:'Outline', sty:'outline', ls:0.5},
        {name:'Black Serif', sty:'black', ls:-0.5},
      ];
      templates.forEach(t=>{
        const b = document.createElement('button');
        b.className = 'px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-xs text-left';
        b.textContent = t.name;
        b.addEventListener('click', ()=>{
          state.style = t.sty; state.letterSpacing = t.ls; renderEditor(); saveLocal();
        });
        wrap.appendChild(b);
      });
    }

    /* =============================
       Editor Overlay & Wiring
    ==============================*/
    function openEditor(){
      $('#editorOverlay').classList.remove('hidden');
      $('#edWordA').value = state.words.a;
      $('#edWordB').value = state.words.b;
      $('#edSymmetry').value = state.symmetry;
      $('#edAngle').value = state.angle;
      $('#edLetterSpace').value = state.letterSpacing;
      renderEditor();
    }

    function closeEditor(){
      $('#editorOverlay').classList.add('hidden');
      renderPreview();
    }

    /* =============================
       Mockups
    ==============================*/
    function svgToCanvasImage(svg){
      return new Promise(res=>{
        const str = svgToString(svg);
        const img = new Image();
        const blob = new Blob([str], {type:'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        img.onload = ()=>{res({img, url});};
        img.src = url;
      });
    }

    async function showMockups(){
      $('#mockupModal').classList.remove('hidden');
      const editorSvg = $('#editorSVG');
      const {img, url} = await svgToCanvasImage(editorSvg);

      // Tee canvas
      const tee = $('#mockupTee'); const ct = tee.getContext('2d');
      ct.fillStyle = '#111827'; ct.fillRect(0,0,tee.width,tee.height);
      // Simple shirt shape
      ct.fillStyle = '#222c3d';
      ct.fillRect(250,120,400,560);
      // Place design
      ct.drawImage(img, 200, 250, 500, 300);

      // Mug canvas
      const mug = $('#mockupMug'); const cm = mug.getContext('2d');
      cm.fillStyle = '#0b1220'; cm.fillRect(0,0,mug.width,mug.height);
      // Mug body
      cm.fillStyle = '#e5e7eb'; cm.fillRect(250,150,400,300);
      // Handle
      cm.beginPath(); cm.arc(650,300,80, -Math.PI/2, Math.PI/2); cm.strokeStyle = '#e5e7eb'; cm.lineWidth=30; cm.stroke();
      // Design
      cm.drawImage(img, 280, 190, 340, 220);

      URL.revokeObjectURL(url);
    }

    /* =============================
       Event Listeners
    ==============================*/
    window.addEventListener('hashchange', ()=>{ loadStateFromHash(); renderPreview(); });

    // Hero controls
    $('#btnGenerate').addEventListener('click', ()=>{
      state.words.a = toTitle($('#wordA').value);
      state.words.b = toTitle($('#wordB').value);
      state.symmetry = $('#symmetry').value;
      setHashFromState(); saveLocal(); renderPreview();
    });
    $('#btnOpenEditor').addEventListener('click', ()=>{
      if(!state.words.a){ state.words.a = toTitle($('#wordA').value || 'AMBIGRAMOO'); }
      state.words.b = toTitle($('#wordB').value);
      state.symmetry = $('#symmetry').value;
      openEditor(); setHashFromState(); saveLocal();
    });

    $('#angle').addEventListener('input', (e)=>{ state.angle = Number(e.target.value); $('#angleLabel').textContent = `${state.angle}°`; renderPreview(); saveLocal(); });

    $all('.styleBtn').forEach(b=>{
      b.addEventListener('click', ()=>{ state.style = b.dataset.style; renderPreview(); saveLocal(); });
    });

    // Downloads from hero
    $('#btnDownloadSVG').addEventListener('click', ()=> exportSVG('#previewSVG', (state.words.a||'ambigram').toLowerCase()));
    $('#btnDownloadPNG').addEventListener('click', ()=>{
      const scale = state.isPro ? 4 : 2;
      exportPNG('#previewSVG', (state.words.a||'ambigram').toLowerCase(), scale);
    });
    $('#btnDownloadPDF').addEventListener('click', ()=> exportPDFviaCanvas('#previewSVG', (state.words.a||'ambigram').toLowerCase()));

    // Editor controls
    $('#btnCloseEditor').addEventListener('click', closeEditor);
    $('#edWordA').addEventListener('input', (e)=>{ state.words.a = toTitle(e.target.value); renderEditor(); saveLocal(); setHashFromState(); });
    $('#edWordB').addEventListener('input', (e)=>{ state.words.b = toTitle(e.target.value); renderEditor(); saveLocal(); setHashFromState(); });
    $('#edSymmetry').addEventListener('change', (e)=>{ state.symmetry = e.target.value; renderEditor(); saveLocal(); setHashFromState(); });
    $('#edAngle').addEventListener('input', (e)=>{ state.angle = Number(e.target.value); $('#edAngleLabel').textContent = `${state.angle}°`; renderEditor(); saveLocal(); setHashFromState(); });
    $('#edLetterSpace').addEventListener('input', (e)=>{ state.letterSpacing = Number(e.target.value); $('#edLsVal').textContent = `${state.letterSpacing}`; renderEditor(); saveLocal(); setHashFromState(); });
    $all('.edStyle').forEach(b=> b.addEventListener('click', ()=>{ state.style = b.dataset.style; renderEditor(); saveLocal(); setHashFromState(); }));

    $('#edExportSVG').addEventListener('click', ()=> exportSVG('#editorSVG', (state.words.a||'ambigram').toLowerCase()));
    $('#edExportPNG').addEventListener('click', ()=>{
      const scale = state.isPro ? 4 : 2;
      exportPNG('#editorSVG', (state.words.a||'ambigram').toLowerCase(), scale);
    });
    $('#edExportPDF').addEventListener('click', ()=> exportPDFviaCanvas('#editorSVG', (state.words.a||'ambigram').toLowerCase()));

    // Mockups
    $('#btnMockup').addEventListener('click', showMockups);
    $('#btnCloseMockup').addEventListener('click', ()=> $('#mockupModal').classList.add('hidden'));

    // Go Pro demo toggle
    function togglePro(){ state.isPro = !state.isPro; alert(`Pro is now ${state.isPro? 'ENABLED' : 'DISABLED'} (demo toggle).`); }
    $('#btnGoPro').addEventListener('click', togglePro);
    $('#btnGoProTop').addEventListener('click', togglePro);

    // Practice PDF placeholder
    $('#btnPracticePDF').addEventListener('click', (e)=>{ e.preventDefault(); alert('Practice sheets are part of Pro in this demo.'); });

    // Initial load
    restoreLocal();
    loadStateFromHash();
    // hydrate hero fields
    $('#wordA').value = state.words.a || '';
    $('#wordB').value = state.words.b || '';
    $('#symmetry').value = state.symmetry;
    $('#angle').value = state.angle;

    renderPreview();
    buildGallery();
  </script>
</body>
</html>

